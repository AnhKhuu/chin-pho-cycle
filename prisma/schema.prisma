// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

// *** START OF PRODUCT SCHEMAS *** //

// Product model contains general attributes
model Product {
  sku         String @id @default(uuid())
  name        String
  description String

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  brandId String
  brand   Brand  @relation(fields: [brandId], references: [id])

  price Float

  sizes   Size[] // available sizes
  colors  String[] // available colors
  genders Gender[] // available genders
  items   ProductItem[] // all variants

  @@index([brandId])
  @@index([categoryId])
}

// Product Item contains variant data (color, size)
model ProductItem {
  id String @id @default(uuid())

  productSku String
  product    Product @relation(fields: [productSku], references: [sku])

  size   Size?
  color  String?
  gender Gender?
  stock  Int // how many left of this variant

  images ProductImage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productSku])
}

model ProductImage {
  id String @id @default(uuid())

  productItemId String
  productItem   ProductItem @relation(fields: [productItemId], references: [id], onDelete: Cascade)

  url String

  @@index([productItemId])
}

model Category {
  id    String @id @default(uuid())
  value String @unique

  products Product[]
}

model Brand {
  id          String @id @default(uuid())
  name        String
  description String
  imageUrl    String

  products Product[]
}

enum Size {
  XS
  S
  M
  L
  XL
  XXL
}

enum Gender {
  Male
  Female
  Unisex
}

// *** END OF PRODUCT SCHEMAS *** //
